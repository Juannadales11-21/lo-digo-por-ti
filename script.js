
const translations = {
  es: {
    'hero.badge': 'Mensajes premium',
    'hero.title': 'Lo digo por ti',
    'hero.subtitle': 'Genera mensajes listos para enviar en segundos con un tono impecable y humano.',
    'form.situationLabel': 'Busca una situación',
    'form.situationPlaceholder': 'Ej: Recordar un pago pendiente',
    'form.descriptionLabel': 'Describe tu situación',
    'form.descriptionPlaceholder': 'Ej: Presté dinero a un amigo hace dos meses y quiero recordárselo sin sonar agresivo...',
    'form.toneLabel': 'Tono',
    'form.toneFormal': 'Formal',
    'form.toneClose': 'Cercano',
    'form.toneFun': 'Divertido',
    'form.intensityLabel': 'Intensidad',
    'form.intensity1': '1 Suave',
    'form.intensity2': '2 Neutro',
    'form.intensity3': '3 Directo',
    'form.intensity4': '4 Muy directo',
    'form.generateBtn': 'Generar mensaje',
    'form.humanized': 'Texto optimizado para sonar natural y humano.',
    'results.eyebrow': 'Resultados',
    'results.title': 'Opciones listas para copiar',
    'results.empty': 'Escribe la situación y pulsa "Generar mensaje".',
    'results.error': 'No hemos podido generar un mensaje. Usa estas opciones listas.',
    'examples.eyebrow': 'Ejemplos',
    'examples.title': 'Cargar un ejemplo para empezar',
    'examples.useBtn': 'Usar este ejemplo',
    'examples.category.trabajo': 'Trabajo',
    'examples.category.pareja': 'Pareja',
    'examples.category.familia_amigos': 'Familia/Amigos',
    'examples.category.formal': 'Formal',
    'examples.category.urgente': 'Urgente',
    'examples.category.personalizado': 'Personalizado',
    'examples.category.general': 'General',
    'favorites.eyebrow': 'Favoritos',
    'favorites.title': 'Tus mensajes guardados',
    'favorites.empty': 'Aún no has guardado favoritos.',
    'buttons.copy': 'Copiar',
    'buttons.copied': 'Copiado',
    'buttons.saveFavorite': 'Guardar favorito',
    'buttons.favorited': 'Favorito',
    'buttons.useExample': 'Usar este ejemplo',
    'status.loading': 'Generando mensajes...',
    'status.ready': 'Opciones listas',
    'intensity.value.1': 'Suave',
    'intensity.value.2': 'Neutro',
    'intensity.value.3': 'Directo',
    'intensity.value.4': 'Muy directo'
  },
  en: {
    'hero.badge': 'Premium messages',
    'hero.title': 'Lo digo por ti',
    'hero.subtitle': 'Generate ready-to-send messages in seconds with a natural, human tone.',
    'form.situationLabel': 'Find a situation',
    'form.situationPlaceholder': 'e.g., Remind about a pending payment',
    'form.descriptionLabel': 'Describe your situation',
    'form.descriptionPlaceholder': 'e.g., I lent money to a friend two months ago and want to remind them politely...',
    'form.toneLabel': 'Tone',
    'form.toneFormal': 'Formal',
    'form.toneClose': 'Friendly',
    'form.toneFun': 'Playful',
    'form.intensityLabel': 'Intensity',
    'form.intensity1': '1 Soft',
    'form.intensity2': '2 Neutral',
    'form.intensity3': '3 Direct',
    'form.intensity4': '4 Very direct',
    'form.generateBtn': 'Generate message',
    'form.humanized': 'Text optimized to sound natural and human-like.',
    'results.eyebrow': 'Results',
    'results.title': 'Ready-to-copy options',
    'results.empty': 'Describe the situation and tap "Generate message".',
    'results.error': 'We could not generate a message. Try these ready options.',
    'examples.eyebrow': 'Examples',
    'examples.title': 'Load an example to start',
    'examples.useBtn': 'Use this example',
    'examples.category.trabajo': 'Work',
    'examples.category.pareja': 'Relationship',
    'examples.category.familia_amigos': 'Family/Friends',
    'examples.category.formal': 'Formal',
    'examples.category.urgente': 'Urgent',
    'examples.category.personalizado': 'Custom',
    'examples.category.general': 'General',
    'favorites.eyebrow': 'Favorites',
    'favorites.title': 'Saved messages',
    'favorites.empty': 'You have no favorites yet.',
    'buttons.copy': 'Copy',
    'buttons.copied': 'Copied',
    'buttons.saveFavorite': 'Save favorite',
    'buttons.favorited': 'Favorite',
    'buttons.useExample': 'Use this example',
    'status.loading': 'Generating messages...',
    'status.ready': 'Options ready',
    'intensity.value.1': 'Soft',
    'intensity.value.2': 'Neutral',
    'intensity.value.3': 'Direct',
    'intensity.value.4': 'Very direct'
  },
  fr: {
    'hero.badge': 'Messages premium',
    'hero.title': 'Lo digo por ti',
    'hero.subtitle': 'Générez des messages prêts à envoyer en quelques secondes, avec un ton naturel et humain.',
    'form.situationLabel': 'Trouver une situation',
    'form.situationPlaceholder': 'Ex : Rappeler un paiement en attente',
    'form.descriptionLabel': 'Décris ta situation',
    'form.descriptionPlaceholder': 'Ex : J’ai prêté de l’argent à un ami il y a deux mois et je veux le lui rappeler sans être brusque...',
    'form.toneLabel': 'Ton',
    'form.toneFormal': 'Formel',
    'form.toneClose': 'Proche',
    'form.toneFun': 'Ludique',
    'form.intensityLabel': 'Intensité',
    'form.intensity1': '1 Doux',
    'form.intensity2': '2 Neutre',
    'form.intensity3': '3 Direct',
    'form.intensity4': '4 Très direct',
    'form.generateBtn': 'Générer',
    'form.humanized': 'Texte optimisé pour paraître naturel et humain.',
    'results.eyebrow': 'Résultats',
    'results.title': 'Options prêtes à copier',
    'results.empty': 'Décris la situation puis clique sur "Générer".',
    'results.error': 'Impossible de générer un message. Voici des options prêtes.',
    'examples.eyebrow': 'Exemples',
    'examples.title': 'Charger un exemple pour commencer',
    'examples.useBtn': 'Utiliser cet exemple',
    'examples.category.trabajo': 'Travail',
    'examples.category.pareja': 'Couple',
    'examples.category.familia_amigos': 'Famille/Amis',
    'examples.category.formal': 'Formel',
    'examples.category.urgente': 'Urgent',
    'examples.category.personalizado': 'Personnalisé',
    'examples.category.general': 'Général',
    'favorites.eyebrow': 'Favoris',
    'favorites.title': 'Messages enregistrés',
    'favorites.empty': 'Aucun favori pour le moment.',
    'buttons.copy': 'Copier',
    'buttons.copied': 'Copié',
    'buttons.saveFavorite': 'Enregistrer',
    'buttons.favorited': 'Favori',
    'buttons.useExample': 'Utiliser cet exemple',
    'status.loading': 'Génération en cours...',
    'status.ready': 'Options prêtes',
    'intensity.value.1': 'Doux',
    'intensity.value.2': 'Neutre',
    'intensity.value.3': 'Direct',
    'intensity.value.4': 'Très direct'
  },
  de: {
    'hero.badge': 'Premium-Nachrichten',
    'hero.title': 'Lo digo por ti',
    'hero.subtitle': 'Erstelle in Sekunden versandfertige Nachrichten mit natürlichem, menschlichem Ton.',
    'form.situationLabel': 'Situation finden',
    'form.situationPlaceholder': 'z. B. An eine offene Zahlung erinnern',
    'form.descriptionLabel': 'Beschreibe deine Situation',
    'form.descriptionPlaceholder': 'z. B. Ich habe einem Freund Geld geliehen und möchte ihn höflich erinnern...',
    'form.toneLabel': 'Ton',
    'form.toneFormal': 'Formell',
    'form.toneClose': 'Nahbar',
    'form.toneFun': 'Locker',
    'form.intensityLabel': 'Intensität',
    'form.intensity1': '1 Sanft',
    'form.intensity2': '2 Neutral',
    'form.intensity3': '3 Direkt',
    'form.intensity4': '4 Sehr direkt',
    'form.generateBtn': 'Nachricht erstellen',
    'form.humanized': 'Text optimiert, um natürlich und menschlich zu klingen.',
    'results.eyebrow': 'Ergebnisse',
    'results.title': 'Sofort kopierbare Optionen',
    'results.empty': 'Beschreibe die Situation und klicke „Nachricht erstellen“.',
    'results.error': 'Nachricht konnte nicht erstellt werden. Nutze diese Optionen.',
    'examples.eyebrow': 'Beispiele',
    'examples.title': 'Ein Beispiel zum Start wählen',
    'examples.useBtn': 'Beispiel nutzen',
    'examples.category.trabajo': 'Arbeit',
    'examples.category.pareja': 'Beziehung',
    'examples.category.familia_amigos': 'Familie/Freunde',
    'examples.category.formal': 'Formell',
    'examples.category.urgente': 'Dringend',
    'examples.category.personalizado': 'Individuell',
    'examples.category.general': 'Allgemein',
    'favorites.eyebrow': 'Favoriten',
    'favorites.title': 'Gespeicherte Nachrichten',
    'favorites.empty': 'Noch keine Favoriten.',
    'buttons.copy': 'Kopieren',
    'buttons.copied': 'Kopiert',
    'buttons.saveFavorite': 'Favorit speichern',
    'buttons.favorited': 'Favorit',
    'buttons.useExample': 'Beispiel nutzen',
    'status.loading': 'Nachrichten werden erstellt...',
    'status.ready': 'Optionen bereit',
    'intensity.value.1': 'Sanft',
    'intensity.value.2': 'Neutral',
    'intensity.value.3': 'Direkt',
    'intensity.value.4': 'Sehr direkt'
  },
  it: {
    'hero.badge': 'Messaggi premium',
    'hero.title': 'Lo digo por ti',
    'hero.subtitle': 'Genera messaggi pronti all’uso in pochi secondi con un tono naturale e umano.',
    'form.situationLabel': 'Cerca una situazione',
    'form.situationPlaceholder': 'Es: Ricordare un pagamento in sospeso',
    'form.descriptionLabel': 'Descrivi la situazione',
    'form.descriptionPlaceholder': 'Es: Ho prestato soldi a un amico e voglio ricordarglielo con tatto...',
    'form.toneLabel': 'Tono',
    'form.toneFormal': 'Formale',
    'form.toneClose': 'Vicino',
    'form.toneFun': 'Divertente',
    'form.intensityLabel': 'Intensità',
    'form.intensity1': '1 Leggero',
    'form.intensity2': '2 Neutro',
    'form.intensity3': '3 Diretto',
    'form.intensity4': '4 Molto diretto',
    'form.generateBtn': 'Genera messaggio',
    'form.humanized': 'Testo ottimizzato per sembrare naturale e umano.',
    'results.eyebrow': 'Risultati',
    'results.title': 'Opzioni pronte da copiare',
    'results.empty': 'Descrivi la situazione e premi "Genera messaggio".',
    'results.error': 'Non siamo riusciti a generare il messaggio. Usa queste opzioni.',
    'examples.eyebrow': 'Esempi',
    'examples.title': 'Carica un esempio per iniziare',
    'examples.useBtn': 'Usa questo esempio',
    'examples.category.trabajo': 'Lavoro',
    'examples.category.pareja': 'Coppia',
    'examples.category.familia_amigos': 'Famiglia/Amici',
    'examples.category.formal': 'Formale',
    'examples.category.urgente': 'Urgente',
    'examples.category.personalizado': 'Personalizzato',
    'examples.category.general': 'Generale',
    'favorites.eyebrow': 'Preferiti',
    'favorites.title': 'I tuoi messaggi salvati',
    'favorites.empty': 'Non hai ancora preferiti.',
    'buttons.copy': 'Copia',
    'buttons.copied': 'Copiato',
    'buttons.saveFavorite': 'Salva nei preferiti',
    'buttons.favorited': 'Preferito',
    'buttons.useExample': 'Usa questo esempio',
    'status.loading': 'Generazione in corso...',
    'status.ready': 'Opzioni pronte',
    'intensity.value.1': 'Leggero',
    'intensity.value.2': 'Neutro',
    'intensity.value.3': 'Diretto',
    'intensity.value.4': 'Molto diretto'
  },
  pt: {
    'hero.badge': 'Mensagens premium',
    'hero.title': 'Lo digo por ti',
    'hero.subtitle': 'Gere mensagens prontas para enviar em segundos, com tom natural e humano.',
    'form.situationLabel': 'Busque uma situação',
    'form.situationPlaceholder': 'Ex.: Lembrar um pagamento pendente',
    'form.descriptionLabel': 'Descreva a situação',
    'form.descriptionPlaceholder': 'Ex.: Emprestei dinheiro a um amigo e quero lembrar sem parecer rude...',
    'form.toneLabel': 'Tom',
    'form.toneFormal': 'Formal',
    'form.toneClose': 'Próximo',
    'form.toneFun': 'Divertido',
    'form.intensityLabel': 'Intensidade',
    'form.intensity1': '1 Suave',
    'form.intensity2': '2 Neutro',
    'form.intensity3': '3 Direto',
    'form.intensity4': '4 Bem direto',
    'form.generateBtn': 'Gerar mensagem',
    'form.humanized': 'Texto otimizado para soar natural e humano.',
    'results.eyebrow': 'Resultados',
    'results.title': 'Opções prontas para copiar',
    'results.empty': 'Descreva a situação e clique em "Gerar".',
    'results.error': 'Não foi possível gerar. Use estas opções prontas.',
    'examples.eyebrow': 'Exemplos',
    'examples.title': 'Carregue um exemplo para começar',
    'examples.useBtn': 'Usar este exemplo',
    'examples.category.trabajo': 'Trabalho',
    'examples.category.pareja': 'Relacionamento',
    'examples.category.familia_amigos': 'Família/Amigos',
    'examples.category.formal': 'Formal',
    'examples.category.urgente': 'Urgente',
    'examples.category.personalizado': 'Personalizado',
    'examples.category.general': 'Geral',
    'favorites.eyebrow': 'Favoritos',
    'favorites.title': 'Mensagens salvas',
    'favorites.empty': 'Você ainda não tem favoritos.',
    'buttons.copy': 'Copiar',
    'buttons.copied': 'Copiado',
    'buttons.saveFavorite': 'Salvar favorito',
    'buttons.favorited': 'Favorito',
    'buttons.useExample': 'Usar este exemplo',
    'status.loading': 'Gerando mensagens...',
    'status.ready': 'Opções prontas',
    'intensity.value.1': 'Suave',
    'intensity.value.2': 'Neutro',
    'intensity.value.3': 'Direto',
    'intensity.value.4': 'Bem direto'
  }
};

const examples = [
  // Español
  {
    id: 'es-pago-cliente',
    category: 'trabajo',
    title: 'Recordar pago pendiente a cliente',
    quick: 'Recordar pago pendiente',
    details: 'Quiero recordar a un cliente una factura sin sonar agresivo.',
    tone: 'formal',
    intensity: 2,
    language: 'es'
  },
  {
    id: 'es-aumento',
    category: 'trabajo',
    title: 'Pedir un aumento con tacto',
    quick: 'Pedir aumento',
    details: 'Destacar mis logros y pedir revisión salarial sin presión.',
    tone: 'formal',
    intensity: 2,
    language: 'es'
  },
  {
    id: 'es-disculpa',
    category: 'pareja',
    title: 'Disculpa después de discusión',
    quick: 'Disculpa sincera',
    details: 'Pedir perdón mostrando que me importa sin dramatizar.',
    tone: 'cercano',
    intensity: 2,
    language: 'es'
  },
  {
    id: 'es-espacio',
    category: 'pareja',
    title: 'Pedir espacio con respeto',
    quick: 'Pedir un tiempo',
    details: 'Solicitar un poco de espacio sin herir a mi pareja.',
    tone: 'cercano',
    intensity: 2,
    language: 'es'
  },
  {
    id: 'es-reunion-familia',
    category: 'familia_amigos',
    title: 'Coordinar reunión familiar',
    quick: 'Organizar reunión',
    details: 'Proponer comida el domingo y confirmar asistentes.',
    tone: 'cercano',
    intensity: 2,
    language: 'es'
  },
  {
    id: 'es-urgente',
    category: 'urgente',
    title: 'Pedir devolución urgente',
    quick: 'Necesito devolución hoy',
    details: 'Pedir que me devuelvan algo prestado hoy sin sonar borde.',
    tone: 'cercano',
    intensity: 3,
    language: 'es'
  },
  {
    id: 'es-formal-cita',
    category: 'formal',
    title: 'Confirmar reunión formal',
    quick: 'Confirmar reunión',
    details: 'Confirmar fecha y hora con un cliente de forma profesional.',
    tone: 'formal',
    intensity: 2,
    language: 'es'
  },
  {
    id: 'es-feedback',
    category: 'trabajo',
    title: 'Dar feedback delicado',
    quick: 'Feedback cuidadoso',
    details: 'Compartir mejoras con un compañero manteniendo buena relación.',
    tone: 'cercano',
    intensity: 2,
    language: 'es'
  },
  // English
  {
    id: 'en-invoice-reminder',
    category: 'trabajo',
    title: 'Invoice reminder to a client',
    quick: 'Invoice reminder',
    details: 'Remind about an unpaid invoice without sounding harsh.',
    tone: 'formal',
    intensity: 2,
    language: 'en'
  },
  {
    id: 'en-raise',
    category: 'trabajo',
    title: 'Ask for a raise politely',
    quick: 'Request a raise',
    details: 'Highlight achievements and ask for a salary review.',
    tone: 'formal',
    intensity: 2,
    language: 'en'
  },
  {
    id: 'en-apology',
    category: 'pareja',
    title: 'Apologize after disagreement',
    quick: 'Sincere apology',
    details: 'Say sorry, show I care, and invite a calm chat.',
    tone: 'cercano',
    intensity: 2,
    language: 'en'
  },
  {
    id: 'en-family-plan',
    category: 'familia_amigos',
    title: 'Plan a family visit',
    quick: 'Family catch-up',
    details: 'Invite family for a weekend lunch and confirm who can join.',
    tone: 'cercano',
    intensity: 2,
    language: 'en'
  },
  {
    id: 'en-urgent-shift',
    category: 'urgente',
    title: 'Ask to swap a shift',
    quick: 'Shift swap request',
    details: 'Request a shift swap today and offer a quick alternative.',
    tone: 'cercano',
    intensity: 3,
    language: 'en'
  },
  {
    id: 'en-formal-meeting',
    category: 'formal',
    title: 'Confirm a formal meeting',
    quick: 'Meeting confirmation',
    details: 'Confirm date and time with a client in a polished way.',
    tone: 'formal',
    intensity: 2,
    language: 'en'
  },
  {
    id: 'en-feedback',
    category: 'trabajo',
    title: 'Give gentle feedback',
    quick: 'Supportive feedback',
    details: 'Share improvement points with empathy and clarity.',
    tone: 'cercano',
    intensity: 2,
    language: 'en'
  },
  {
    id: 'en-support-friend',
    category: 'familia_amigos',
    title: 'Support a friend going through stress',
    quick: 'Supportive note',
    details: 'Send a caring note offering help to a stressed friend.',
    tone: 'cercano',
    intensity: 1,
    language: 'en'
  },
  // French
  {
    id: 'fr-facture',
    category: 'trabajo',
    title: 'Relancer une facture en attente',
    quick: 'Relance facture',
    details: 'Rappeler un paiement dû sans brusquer.',
    tone: 'formal',
    intensity: 2,
    language: 'fr'
  },
  {
    id: 'fr-augmentation',
    category: 'trabajo',
    title: 'Demander une augmentation',
    quick: 'Demande d’augmentation',
    details: 'Mettre en avant mes résultats et proposer une révision salariale.',
    tone: 'formal',
    intensity: 2,
    language: 'fr'
  },
  {
    id: 'fr-excuses',
    category: 'pareja',
    title: 'Présenter des excuses',
    quick: 'Excuses sincères',
    details: 'Dire pardon après une dispute et proposer d’en parler calmement.',
    tone: 'cercano',
    intensity: 2,
    language: 'fr'
  },
  {
    id: 'fr-famille',
    category: 'familia_amigos',
    title: 'Organiser un dîner de famille',
    quick: 'Dîner de famille',
    details: 'Proposer un repas dimanche et vérifier les disponibilités.',
    tone: 'cercano',
    intensity: 2,
    language: 'fr'
  },
  {
    id: 'fr-urgent',
    category: 'urgente',
    title: 'Demander un document urgent',
    quick: 'Document urgent',
    details: 'Demander un document pour aujourd’hui avec tact.',
    tone: 'formal',
    intensity: 3,
    language: 'fr'
  },
  {
    id: 'fr-formel',
    category: 'formal',
    title: 'Confirmer un rendez-vous',
    quick: 'Confirmation rendez-vous',
    details: 'Confirmer une heure et un lieu de manière professionnelle.',
    tone: 'formal',
    intensity: 2,
    language: 'fr'
  },
  {
    id: 'fr-soutien',
    category: 'familia_amigos',
    title: 'Message de soutien',
    quick: 'Soutien amical',
    details: 'Envoyer un mot chaleureux à un ami stressé.',
    tone: 'cercano',
    intensity: 1,
    language: 'fr'
  },
  {
    id: 'fr-feedback',
    category: 'trabajo',
    title: 'Donner un feedback constructif',
    quick: 'Feedback bienveillant',
    details: 'Partager des pistes d’amélioration avec empathie.',
    tone: 'cercano',
    intensity: 2,
    language: 'fr'
  },
  // German
  {
    id: 'de-rechnung',
    category: 'trabajo',
    title: 'An offene Rechnung erinnern',
    quick: 'Rechnung erinnern',
    details: 'Zahlungserinnerung freundlich formulieren.',
    tone: 'formal',
    intensity: 2,
    language: 'de'
  },
  {
    id: 'de-gehalt',
    category: 'trabajo',
    title: 'Gehaltserhöhung ansprechen',
    quick: 'Gehalt anfragen',
    details: 'Erfolge nennen und um Anpassung bitten.',
    tone: 'formal',
    intensity: 2,
    language: 'de'
  },
  {
    id: 'de-entschuldigung',
    category: 'pareja',
    title: 'Entschuldigung nach Streit',
    quick: 'Versöhnliche Nachricht',
    details: 'Aufrichtig entschuldigen und Gespräch vorschlagen.',
    tone: 'cercano',
    intensity: 2,
    language: 'de'
  },
  {
    id: 'de-familie',
    category: 'familia_amigos',
    title: 'Familientreffen planen',
    quick: 'Familientreffen',
    details: 'Ein Treffen am Wochenende koordinieren.',
    tone: 'cercano',
    intensity: 2,
    language: 'de'
  },
  {
    id: 'de-dringend',
    category: 'urgente',
    title: 'Dringend um Antwort bitten',
    quick: 'Schnelle Antwort',
    details: 'Noch heute eine Rückmeldung erbitten.',
    tone: 'formal',
    intensity: 3,
    language: 'de'
  },
  {
    id: 'de-formal',
    category: 'formal',
    title: 'Termin professionell bestätigen',
    quick: 'Termin bestätigen',
    details: 'Datum und Uhrzeit höflich bestätigen.',
    tone: 'formal',
    intensity: 2,
    language: 'de'
  },
  {
    id: 'de-feedback',
    category: 'trabajo',
    title: 'Konstruktives Feedback geben',
    quick: 'Feedback freundlich',
    details: 'Verbesserungen wertschätzend formulieren.',
    tone: 'cercano',
    intensity: 2,
    language: 'de'
  },
  {
    id: 'de-unterstuetzung',
    category: 'familia_amigos',
    title: 'Unterstützung anbieten',
    quick: 'Unterstützender Gruß',
    details: 'Einem gestressten Freund Hilfe anbieten.',
    tone: 'cercano',
    intensity: 1,
    language: 'de'
  },
  // Italian
  {
    id: 'it-fattura',
    category: 'trabajo',
    title: 'Ricordare una fattura',
    quick: 'Promemoria fattura',
    details: 'Ricordare un pagamento senza sembrare duro.',
    tone: 'formal',
    intensity: 2,
    language: 'it'
  },
  {
    id: 'it-aumento',
    category: 'trabajo',
    title: 'Chiedere un aumento',
    quick: 'Richiesta aumento',
    details: 'Mettere in evidenza i risultati e chiedere revisione.',
    tone: 'formal',
    intensity: 2,
    language: 'it'
  },
  {
    id: 'it-scuse',
    category: 'pareja',
    title: 'Scusarsi dopo una lite',
    quick: 'Scuse sincere',
    details: 'Chiedere scusa e proporre di parlarne con calma.',
    tone: 'cercano',
    intensity: 2,
    language: 'it'
  },
  {
    id: 'it-famiglia',
    category: 'familia_amigos',
    title: 'Organizzare pranzo in famiglia',
    quick: 'Pranzo di famiglia',
    details: 'Proporre pranzo domenicale e chiedere conferma.',
    tone: 'cercano',
    intensity: 2,
    language: 'it'
  },
  {
    id: 'it-urgente',
    category: 'urgente',
    title: 'Chiedere risposta urgente',
    quick: 'Risposta oggi',
    details: 'Richiedere conferma oggi con cortesia.',
    tone: 'formal',
    intensity: 3,
    language: 'it'
  },
  {
    id: 'it-formale',
    category: 'formal',
    title: 'Confermare un appuntamento',
    quick: 'Conferma appuntamento',
    details: 'Confermare data e ora in modo professionale.',
    tone: 'formal',
    intensity: 2,
    language: 'it'
  },
  {
    id: 'it-feedback',
    category: 'trabajo',
    title: 'Dare feedback con tatto',
    quick: 'Feedback gentile',
    details: 'Suggerire miglioramenti con tono positivo.',
    tone: 'cercano',
    intensity: 2,
    language: 'it'
  },
  {
    id: 'it-sostegno',
    category: 'familia_amigos',
    title: 'Offrire sostegno a un amico',
    quick: 'Messaggio di sostegno',
    details: 'Inviare parole di incoraggiamento a chi è sotto stress.',
    tone: 'cercano',
    intensity: 1,
    language: 'it'
  },
  // Portuguese
  {
    id: 'pt-fatura',
    category: 'trabajo',
    title: 'Lembrar uma fatura pendente',
    quick: 'Lembrete de pagamento',
    details: 'Cobrar educadamente uma fatura atrasada.',
    tone: 'formal',
    intensity: 2,
    language: 'pt'
  },
  {
    id: 'pt-aumento',
    category: 'trabajo',
    title: 'Pedir aumento com tato',
    quick: 'Pedir aumento',
    details: 'Apontar resultados e solicitar revisão salarial.',
    tone: 'formal',
    intensity: 2,
    language: 'pt'
  },
  {
    id: 'pt-desculpa',
    category: 'pareja',
    title: 'Pedir desculpas após discussão',
    quick: 'Desculpa sincera',
    details: 'Pedir perdão e propor uma conversa calma.',
    tone: 'cercano',
    intensity: 2,
    language: 'pt'
  },
  {
    id: 'pt-familia',
    category: 'familia_amigos',
    title: 'Marcar almoço em família',
    quick: 'Almoço de família',
    details: 'Convidar para almoço no fim de semana e confirmar presenças.',
    tone: 'cercano',
    intensity: 2,
    language: 'pt'
  },
  {
    id: 'pt-urgente',
    category: 'urgente',
    title: 'Confirmar algo para hoje',
    quick: 'Preciso hoje',
    details: 'Pedir confirmação ou devolução ainda hoje com cordialidade.',
    tone: 'formal',
    intensity: 3,
    language: 'pt'
  },
  {
    id: 'pt-formal',
    category: 'formal',
    title: 'Confirmar reunião formal',
    quick: 'Confirmar reunião',
    details: 'Confirmar data e hora com linguagem profissional.',
    tone: 'formal',
    intensity: 2,
    language: 'pt'
  },
  {
    id: 'pt-feedback',
    category: 'trabajo',
    title: 'Dar feedback gentil',
    quick: 'Feedback construtivo',
    details: 'Sugerir melhorias mantendo o clima positivo.',
    tone: 'cercano',
    intensity: 2,
    language: 'pt'
  },
  {
    id: 'pt-apoio',
    category: 'familia_amigos',
    title: 'Enviar apoio a um amigo',
    quick: 'Mensagem de apoio',
    details: 'Mostrar que estou disponível para ajudar alguém sobrecarregado.',
    tone: 'cercano',
    intensity: 1,
    language: 'pt'
  }
];

const fallbackMessages = {
  es: [
    { category: 'trabajo', text: 'Hola, te recuerdo la entrega de hoy. Si algo se complica, avísame y lo reprogramamos juntos.' },
    { category: 'trabajo', text: 'Buenos días, solo confirmar la factura pendiente. Si necesitas un nuevo plazo, dime y lo coordinamos.' },
    { category: 'pareja', text: 'Siento el malentendido de antes. Me importas y quiero que hablemos con calma cuando puedas.' },
    { category: 'pareja', text: 'Me gustaría que tengamos un momento este fin de semana solo para nosotros. Quiero escucharte y reconectar.' },
    { category: 'familia_amigos', text: '¿Te parece si nos vemos el viernes? Me encantaría saber cómo estás y pasar un rato juntos.' },
    { category: 'familia_amigos', text: 'Gracias por tu ayuda la semana pasada. Significó mucho para mí y quería que lo supieras.' },
    { category: 'formal', text: 'Estimado/a, le confirmo la reunión agendada. Si necesita reprogramar, puedo proponerle nuevos horarios.' },
    { category: 'formal', text: 'Adjunto la información solicitada. Si hay dudas, estaré atento/a para aclararlas de inmediato.' },
    { category: 'urgente', text: '¿Podrías confirmar hoy el envío del material? Si no es posible, avísame para buscar otra opción.' },
    { category: 'urgente', text: 'Por favor, dime si podrás llegar a la hora prevista. Si surge algo, coordinamos otro plan.' },
    { category: 'personalizado', text: 'Hola, solo quería asegurarte que sigo pendiente y listo para ayudarte en lo que necesites.' },
    { category: 'trabajo', text: 'Gracias por tu esfuerzo reciente. Aviso que necesitamos el reporte final hoy para cerrar el proyecto.' }
  ],
  en: [
    { category: 'trabajo', text: 'Hi, quick reminder about today’s delivery. If anything changes, let me know and we’ll adjust together.' },
    { category: 'trabajo', text: 'Good morning, I’m checking on the pending invoice. If you need a new date, tell me and we’ll align.' },
    { category: 'pareja', text: 'I’m sorry about earlier. You matter to me—can we talk calmly when you’re ready?' },
    { category: 'pareja', text: 'I’d love for us to have time together this weekend. I want to hear you and reconnect.' },
    { category: 'familia_amigos', text: 'How about meeting on Friday? I’d like to see you and catch up properly.' },
    { category: 'familia_amigos', text: 'Thank you for your help last week. It meant a lot to me and I wanted to say it clearly.' },
    { category: 'formal', text: 'Dear all, confirming our scheduled meeting. If you need to reschedule, I can propose alternative slots.' },
    { category: 'formal', text: 'Please find the requested info attached. Let me know if you have any questions.' },
    { category: 'urgente', text: 'Could you confirm today if you can send the files? If not, I’ll arrange another solution.' },
    { category: 'urgente', text: 'Please let me know if you can arrive on time. If something comes up, we’ll adjust the plan.' },
    { category: 'personalizado', text: 'I’m here and ready to help with whatever you need—just tell me how I can support you.' },
    { category: 'trabajo', text: 'Thanks for your effort lately. We need the final report today to close the project.' }
  ],
  fr: [
    { category: 'trabajo', text: 'Bonjour, un rappel pour la livraison d’aujourd’hui. Si besoin de décaler, dis-le-moi et on réorganise.' },
    { category: 'trabajo', text: 'Je reviens vers toi au sujet de la facture en attente. Si un nouveau délai est nécessaire, on l’accorde ensemble.' },
    { category: 'pareja', text: 'Je suis désolé pour plus tôt. Tu comptes pour moi—parlons-en calmement quand tu seras prêt(e).' },
    { category: 'pareja', text: 'J’aimerais qu’on prenne du temps ensemble ce week-end. Ça me ferait plaisir de te retrouver.' },
    { category: 'familia_amigos', text: 'On se voit vendredi ? J’aimerais avoir de tes nouvelles et passer un bon moment.' },
    { category: 'familia_amigos', text: 'Merci pour ton aide la semaine dernière. Ça m’a vraiment touché et je voulais te le dire.' },
    { category: 'formal', text: 'Je confirme notre réunion prévue. Si besoin de reporter, je propose d’autres créneaux.' },
    { category: 'formal', text: 'Veuillez trouver ci-joint les informations demandées. Je reste disponible pour toute question.' },
    { category: 'urgente', text: 'Peux-tu confirmer aujourd’hui l’envoi des documents ? Sinon, je prévois une autre option.' },
    { category: 'urgente', text: 'Dis-moi si tu peux arriver à l’heure prévue. En cas d’imprévu, on réajuste ensemble.' },
    { category: 'personalizado', text: 'Je suis là pour t’aider dans ce dont tu as besoin—n’hésite pas à me dire comment.' },
    { category: 'trabajo', text: 'Merci pour tes efforts récents. Nous avons besoin du rapport final aujourd’hui pour clôturer le projet.' }
  ],
  de: [
    { category: 'trabajo', text: 'Hallo, kurze Erinnerung an die Lieferung heute. Wenn etwas dazwischenkommt, sag Bescheid und wir passen es an.' },
    { category: 'trabajo', text: 'Guten Morgen, ich frage wegen der offenen Rechnung nach. Brauchst du einen neuen Termin? Wir finden ihn gern.' },
    { category: 'pareja', text: 'Es tut mir leid wegen vorhin. Du bist mir wichtig—lass uns in Ruhe reden, wenn du bereit bist.' },
    { category: 'pareja', text: 'Ich würde gerne am Wochenende Zeit nur für uns einplanen. Ich möchte dich hören und uns wieder annähern.' },
    { category: 'familia_amigos', text: 'Hast du Freitag Zeit, uns zu treffen? Ich würde mich freuen, dich zu sehen.' },
    { category: 'familia_amigos', text: 'Danke für deine Hilfe letzte Woche. Sie hat mir viel bedeutet, und ich wollte es sagen.' },
    { category: 'formal', text: 'Ich bestätige unseren Termin. Falls eine Verschiebung nötig ist, schlage ich gern Alternativen vor.' },
    { category: 'formal', text: 'Anbei die angeforderten Informationen. Bei Fragen stehe ich sofort zur Verfügung.' },
    { category: 'urgente', text: 'Kannst du heute bestätigen, ob du die Unterlagen senden kannst? Sonst plane ich anders.' },
    { category: 'urgente', text: 'Bitte sag mir, ob du pünktlich sein kannst. Falls etwas passiert, passen wir den Plan an.' },
    { category: 'personalizado', text: 'Ich bin da und helfe gern, egal wobei. Sag mir einfach, was du brauchst.' },
    { category: 'trabajo', text: 'Danke für deinen Einsatz. Wir brauchen den Abschlussbericht heute, um das Projekt zu schließen.' }
  ],
  it: [
    { category: 'trabajo', text: 'Ciao, un promemoria per la consegna di oggi. Se cambia qualcosa, dimmelo e riorganizziamo.' },
    { category: 'trabajo', text: 'Buongiorno, ti scrivo per la fattura in sospeso. Se serve una nuova data, la fissiamo insieme.' },
    { category: 'pareja', text: 'Mi dispiace per prima. Ci tengo a te—parliamone con calma quando sei pronto/a.' },
    { category: 'pareja', text: 'Mi piacerebbe dedicarci del tempo questo weekend, solo noi due. Voglio ascoltarti e ritrovarci.' },
    { category: 'familia_amigos', text: 'Che ne dici di vederci venerdì? Mi farebbe piacere passare un po’ di tempo insieme.' },
    { category: 'familia_amigos', text: 'Grazie per l’aiuto della settimana scorsa. Per me è stato importante dirtelo.' },
    { category: 'formal', text: 'Confermo l’incontro previsto. Se serve riprogrammare, propongo nuovi orari.' },
    { category: 'formal', text: 'In allegato le informazioni richieste. Per qualsiasi domanda, resto a disposizione.' },
    { category: 'urgente', text: 'Puoi confermare oggi l’invio dei file? In caso contrario cerco un’altra soluzione.' },
    { category: 'urgente', text: 'Fammi sapere se riesci ad arrivare puntuale. Se c’è un imprevisto, adattiamo il piano.' },
    { category: 'personalizado', text: 'Sono qui per aiutarti in ciò che ti serve: dimmi solo come posso supportarti.' },
    { category: 'trabajo', text: 'Grazie per il tuo impegno. Abbiamo bisogno del report finale oggi per chiudere il progetto.' }
  ],
  pt: [
    { category: 'trabajo', text: 'Oi, só lembrando da entrega de hoje. Se algo mudar, me avise e reorganizamos juntos.' },
    { category: 'trabajo', text: 'Bom dia, passando para confirmar a fatura pendente. Se precisar de novo prazo, combinamos.' },
    { category: 'pareja', text: 'Desculpa pelo que aconteceu. Você é importante para mim—vamos conversar com calma quando puder?' },
    { category: 'pareja', text: 'Queria que tivéssemos um tempo só nosso neste fim de semana. Quero ouvir você e nos reaproximar.' },
    { category: 'familia_amigos', text: 'Que tal nos encontrarmos sexta? Quero saber de você e colocar a conversa em dia.' },
    { category: 'familia_amigos', text: 'Obrigado pela ajuda na semana passada. Significou muito e queria que soubesse.' },
    { category: 'formal', text: 'Confirmo a reunião marcada. Se precisar reagendar, posso sugerir novos horários.' },
    { category: 'formal', text: 'Segue em anexo as informações solicitadas. Qualquer dúvida, estou à disposição.' },
    { category: 'urgente', text: 'Pode confirmar hoje se conseguirá enviar os arquivos? Se não, busco outra alternativa.' },
    { category: 'urgente', text: 'Por favor, avise se conseguirá chegar no horário. Se algo surgir, ajustamos o plano.' },
    { category: 'personalizado', text: 'Estou aqui para ajudar no que precisar—é só dizer como posso apoiar.' },
    { category: 'trabajo', text: 'Obrigado pelo esforço recente. Precisamos do relatório final hoje para encerrar o projeto.' }
  ]
};

const MAX_MESSAGES = 3;
const FAVORITES_KEY = 'ldpt_favorites';
const HISTORY_KEY = 'ldpt_history';

const situationInput = document.getElementById('situationInput');
const situationTextarea = document.getElementById('situationTextarea');
const toneSelect = document.getElementById('toneSelect');
const intensityRange = document.getElementById('intensityRange');
const intensityValue = document.getElementById('intensityValue');
const languageSelect = document.getElementById('languageSelect');
const generateBtn = document.getElementById('generateBtn');
const resultsContainer = document.getElementById('results');
const examplesContainer = document.getElementById('examples');
const favoritesContainer = document.getElementById('favorites');
const cookieBanner = document.getElementById('cookieBanner');
const cookieAcceptBtn = document.getElementById('cookieAcceptBtn');
const COOKIE_CONSENT_KEY = 'cookie_consent_accepted';

const state = {
  favorites: [],
  history: [],
  lastMessages: [],
  currentLanguage: (languageSelect && languageSelect.value) || 'es'
};

const getDict = (lang) => translations[lang] || translations.es;

const shuffle = (arr) => {
  const cloned = [...arr];
  for (let i = cloned.length - 1; i > 0; i -= 1) {
    const j = Math.floor(Math.random() * (i + 1));
    [cloned[i], cloned[j]] = [cloned[j], cloned[i]];
  }
  return cloned;
};

const updateIntensityLabel = () => {
  const dict = getDict(state.currentLanguage);
  const val = intensityRange.value;
  intensityValue.textContent = dict[`intensity.value.${val}`] || val;
};

const applyLanguage = (lang) => {
  state.currentLanguage = lang;
  const dict = getDict(lang);
  document.documentElement.setAttribute('lang', lang);
  if (languageSelect) languageSelect.value = lang;

  document.querySelectorAll('[data-i18n]').forEach((el) => {
    const key = el.getAttribute('data-i18n');
    if (dict[key]) {
      el.textContent = dict[key];
    }
  });

  document.querySelectorAll('[data-i18n-placeholder]').forEach((el) => {
    const key = el.getAttribute('data-i18n-placeholder');
    if (dict[key]) {
      el.setAttribute('placeholder', dict[key]);
    }
  });

  updateIntensityLabel();
  renderExamples();
  renderMessages(state.lastMessages);
  renderFavorites();
};

const loadFavorites = () => {
  try {
    const stored = localStorage.getItem(FAVORITES_KEY);
    state.favorites = stored ? JSON.parse(stored) : [];
  } catch (e) {
    state.favorites = [];
  }
};

const saveFavorites = () => {
  localStorage.setItem(FAVORITES_KEY, JSON.stringify(state.favorites.slice(0, 200)));
};

const loadHistory = () => {
  try {
    const stored = localStorage.getItem(HISTORY_KEY);
    state.history = stored ? JSON.parse(stored) : [];
  } catch (e) {
    state.history = [];
  }
};

const saveHistory = () => {
  localStorage.setItem(HISTORY_KEY, JSON.stringify(state.history.slice(-20)));
};

const copyText = async (text, btn) => {
  try {
    await navigator.clipboard.writeText(text);
    const dict = getDict(state.currentLanguage);
    const original = btn.textContent;
    btn.textContent = dict['buttons.copied'];
    setTimeout(() => {
      btn.textContent = original;
    }, 1200);
  } catch (err) {
    console.error('Copy failed', err);
  }
};

const createTag = (categoryKey, dict) => {
  const tag = document.createElement('span');
  tag.className = 'tag';
  tag.textContent = dict[`examples.category.${categoryKey}`] || categoryKey;
  return tag;
};

const normalizeMessages = (messages) => {
  if (!Array.isArray(messages)) return [];
  return messages
    .map((item) => {
      if (typeof item === 'string') {
        return { text: item, category: 'personalizado' };
      }
      const text = item.text || item.message || '';
      return {
        text,
        category: item.category || 'personalizado'
      };
    })
    .filter((m) => m.text?.trim());
};

const renderMessages = (messages) => {
  const dict = getDict(state.currentLanguage);
  const normalized = normalizeMessages(messages);
  state.lastMessages = normalized;
  resultsContainer.innerHTML = '';

  if (!normalized.length) {
    const p = document.createElement('p');
    p.className = 'muted';
    p.textContent = dict['results.empty'];
    resultsContainer.appendChild(p);
    return;
  }

  normalized.forEach((item) => {
    const card = document.createElement('div');
    card.className = 'result-card';

    const tag = createTag(item.category || 'personalizado', dict);
    card.appendChild(tag);

    const text = document.createElement('p');
    text.textContent = item.text;
    card.appendChild(text);

    const actions = document.createElement('div');
    actions.className = 'result-actions';

    const copyBtn = document.createElement('button');
    copyBtn.className = 'btn copy-btn';
    copyBtn.textContent = dict['buttons.copy'];
    copyBtn.type = 'button';
    copyBtn.addEventListener('click', () => copyText(item.text, copyBtn));
    actions.appendChild(copyBtn);

    const favoriteBtn = document.createElement('button');
    favoriteBtn.className = 'btn favorite-btn';
    favoriteBtn.type = 'button';
    const isFav = state.favorites.some((fav) => fav.text === item.text);
    favoriteBtn.classList.toggle('active', isFav);
    favoriteBtn.textContent = isFav ? dict['buttons.favorited'] : dict['buttons.saveFavorite'];
    favoriteBtn.addEventListener('click', () => {
      toggleFavorite(item, favoriteBtn);
    });
    actions.appendChild(favoriteBtn);

    card.appendChild(actions);
    resultsContainer.appendChild(card);
  });
};

const renderFavorites = () => {
  const dict = getDict(state.currentLanguage);
  favoritesContainer.innerHTML = '';
  if (!state.favorites.length) {
    const p = document.createElement('p');
    p.className = 'muted';
    p.textContent = dict['favorites.empty'];
    favoritesContainer.appendChild(p);
    return;
  }

  state.favorites.forEach((fav) => {
    const card = document.createElement('div');
    card.className = 'result-card';

    const tag = createTag(fav.category || 'personalizado', dict);
    card.appendChild(tag);

    const text = document.createElement('p');
    text.textContent = fav.text;
    card.appendChild(text);

    const actions = document.createElement('div');
    actions.className = 'result-actions';

    const copyBtn = document.createElement('button');
    copyBtn.className = 'btn copy-btn';
    copyBtn.textContent = dict['buttons.copy'];
    copyBtn.type = 'button';
    copyBtn.addEventListener('click', () => copyText(fav.text, copyBtn));

    const favoriteBtn = document.createElement('button');
    favoriteBtn.className = 'btn favorite-btn';
    favoriteBtn.classList.add('active');
    favoriteBtn.textContent = dict['buttons.favorited'];
    favoriteBtn.type = 'button';
    favoriteBtn.addEventListener('click', () => toggleFavorite(fav, favoriteBtn));

    actions.appendChild(copyBtn);
    actions.appendChild(favoriteBtn);
    card.appendChild(actions);
    favoritesContainer.appendChild(card);
  });
};

const toggleFavorite = (item, btn) => {
  const existingIndex = state.favorites.findIndex((fav) => fav.text === item.text);
  const dict = getDict(state.currentLanguage);

  if (existingIndex >= 0) {
    state.favorites.splice(existingIndex, 1);
  } else {
    state.favorites.unshift({
      id: Date.now().toString(),
      text: item.text,
      category: item.category || 'personalizado',
      language: state.currentLanguage,
      tone: toneSelect.value,
      intensity: Number(intensityRange.value),
      createdAt: new Date().toISOString()
    });
  }

  saveFavorites();
  renderFavorites();

  if (btn) {
    const isFav = existingIndex === -1;
    btn.classList.toggle('active', isFav);
    btn.textContent = isFav ? dict['buttons.favorited'] : dict['buttons.saveFavorite'];
  }
};

const buildFallbackMessages = (lang) => {
  const list = fallbackMessages[lang] || fallbackMessages.es;
  return shuffle(list).slice(0, MAX_MESSAGES);
};

const renderExamples = () => {
  const lang = state.currentLanguage;
  const dict = getDict(lang);
  examplesContainer.innerHTML = '';
  const filtered = examples.filter((ex) => ex.language === lang);
  const selection = shuffle(filtered).slice(0, 6);

  selection.forEach((ex) => {
    const card = document.createElement('div');
    card.className = 'example-card';

    const tag = createTag(ex.category, dict);
    card.appendChild(tag);

    const title = document.createElement('h4');
    title.textContent = ex.title;
    card.appendChild(title);

    const meta = document.createElement('p');
    meta.className = 'example-meta';
    meta.textContent = ex.details;
    card.appendChild(meta);

    const btn = document.createElement('button');
    btn.className = 'btn example-btn';
    btn.textContent = dict['buttons.useExample'];
    btn.type = 'button';
    btn.addEventListener('click', () => applyExample(ex));
    card.appendChild(btn);

    examplesContainer.appendChild(card);
  });
};

const applyExample = (example) => {
  situationInput.value = example.quick;
  situationTextarea.value = example.details;
  toneSelect.value = example.tone;
  intensityRange.value = example.intensity;
  updateIntensityLabel();
  if (example.language && example.language !== state.currentLanguage) {
    applyLanguage(example.language);
  }
  window.scrollTo({
    top: 0,
    behavior: 'smooth'
  });
};

const saveHistoryEntry = (payload, messages) => {
  const entry = {
    id: Date.now().toString(),
    createdAt: new Date().toISOString(),
    title: payload.quick || situationInput.value,
    description: situationTextarea.value,
    tone: payload.tone,
    intensity: payload.intensity,
    language: payload.language,
    messages
  };
  state.history.push(entry);
  saveHistory();
};

const setLoadingState = (isLoading) => {
  generateBtn.disabled = isLoading;
  const dict = getDict(state.currentLanguage);
  if (isLoading) {
    resultsContainer.innerHTML = `<p class="status">${dict['status.loading']}</p>`;
  }
};

const generateMessages = async () => {
  const title = situationInput.value.trim();
  const description = situationTextarea.value.trim();
  if (!title || !description) {
    renderMessages([]);
    return;
  }

  const language = state.currentLanguage;
  const tone = toneSelect.value;
  const intensity = Number(intensityRange.value);
  const situation = `${title} — ${description}`;
  const payload = { situation, tone, intensity, language, channel: 'generic', quick: title };

  setLoadingState(true);

  try {
    const response = await fetch('/api/generate-message', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    const data = await response.json();
    if (data?.messages && Array.isArray(data.messages) && data.messages.length) {
      const mapped = normalizeMessages(data.messages)
        .slice(0, MAX_MESSAGES)
        .map((m) => ({
          text: m.text,
          category: m.category || 'personalizado'
        }));
      renderMessages(mapped);
      saveHistoryEntry(payload, mapped);
    } else {
      const fallback = buildFallbackMessages(language);
      renderMessages(fallback);
    }
  } catch (error) {
    console.error('Generation failed', error);
    const fallback = buildFallbackMessages(state.currentLanguage);
    renderMessages(fallback);
  } finally {
    setLoadingState(false);
  }
};

const hasCookieConsent = () => {
  try {
    return localStorage.getItem(COOKIE_CONSENT_KEY) === 'true';
  } catch (e) {
    return false;
  }
};

const setCookieConsent = () => {
  try {
    localStorage.setItem(COOKIE_CONSENT_KEY, 'true');
  } catch (e) {
    // ignore
  }
};

const showCookieBanner = () => {
  if (!cookieBanner) return;
  cookieBanner.classList.add('visible');
  cookieBanner.removeAttribute('aria-hidden');
};

const hideCookieBanner = () => {
  if (!cookieBanner) return;
  cookieBanner.classList.remove('visible');
  cookieBanner.setAttribute('aria-hidden', 'true');
};

const initCookieBanner = () => {
  if (!cookieBanner || !cookieAcceptBtn) return;
  if (hasCookieConsent()) {
    hideCookieBanner();
  } else {
    showCookieBanner();
  }

  cookieAcceptBtn.addEventListener('click', () => {
    setCookieConsent();
    hideCookieBanner();
  });
};

document.addEventListener('DOMContentLoaded', () => {
  loadFavorites();
  loadHistory();
  applyLanguage(state.currentLanguage);
  updateIntensityLabel();

  languageSelect.addEventListener('change', (e) => applyLanguage(e.target.value));
  intensityRange.addEventListener('input', updateIntensityLabel);
  generateBtn.addEventListener('click', generateMessages);
  initCookieBanner();
});
